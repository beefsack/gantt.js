(function(){var a,b;a=function(a){return a.toString("yyyy-MM-dd")},b=function(a){return new XDate(a)},this.GanttDate=function(){function b(a){this.set(a)}return b.prototype.date=null,b.prototype.hour=null,b.prototype.availableHours=null,b.prototype.ratio=function(){return this.hour==null||this.availableHours==null?null:this.hour/this.availableHours},b.prototype.comparable=function(){return""+this.date+" "+(this.hour<10?"0":"")+this.hour},b.prototype.set=function(a){a.date!=null&&this.setDate(a.date),a.hour!=null&&(this.hour=a.hour);if(a.availableHours!=null)return this.availableHours=a.availableHours},b.prototype.setDate=function(b){return this.date=_.isObject(b)?a(b):b},b}(),GanttDate.dateToIso=a,GanttDate.isoToDate=b}).call(this),function(){this.GanttSchedule=function(){function a(){}return a.prototype.defaultWorkTimes={Monday:8,Tuesday:8,Wednesday:8,Thursday:8,Friday:8,Saturday:0,Sunday:0},a.prototype.overriddenWorkTimes={},a.prototype.getDateAfterDuration=function(a,b){var c,d,e;a.hour!=null&&(b+=a.hour),c=new XDate(a.date);for(;;){d=this.getAvailableHoursForDate(c),b-=d;if(b<=0)break;c=c.addDays(1)}return e=d+b,new GanttDate({date:c,hour:e,availableHours:d})},a.prototype.getDateBeforeDuration=function(a,b){var c,d,e;a.hour!=null&&(b-=a.hour),c=new XDate(a.date);while(!(b<=0))c.addDays(-1),d=this.getAvailableHoursForDate(c),b-=d;return e=-b,new GanttDate({date:c,hour:e,availableHours:d})},a.prototype.getAvailableHoursForDate=function(a){return a.getMilliseconds!=null&&(a=GanttDate.dateToIso(a)),this.overriddenWorkTimes[a]||this.defaultWorkTimes[GanttDate.isoToDate(a).toString("dddd")]},a.prototype.getHoursBetweenDates=function(a,b,c,d){var e,f;f=d-b,e=_.clone(a);while(e!==c)f+=this.getAvailableHoursForDate(e),e=e.addDays(1);return f},a}()}.call(this),function(){this.Gantt=function(){function a(a){a==null&&(a={}),a.activities!=null&&(this.activities=a.activities),a.defaultWorkTimes!=null&&(this.defaultWorkTimes=a.defaultWorkTimes)}return a.prototype.activities={},a.prototype.schedules={"default":new GanttSchedule},a.prototype.startDate=new GanttDate({date:new XDate}),a.prototype.getCompiledActivities=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n=this;b=[],c={},f=this.getDependantMap(),m=this.activities;for(g in m)a=m[g],a=_.clone(a),a.name=g,a.dependants=f[g],c[g]=b.length,b.push(a);h=this.startDate,e=function(a){var d,f,g,i,j,k;if(a.startDate!=null&&a.endDate!=null)return a;d=n.startDate,k=a.predecessors;for(i=0,j=k.length;i<j;i++)g=k[i],f=e(b[c[g]]),f.endDate.comparable()>d.comparable()&&(d=f.endDate);return a.startDate=d,a.endDate=n.getActivitySchedule(a).getDateAfterDuration(d,a.duration),a.endDate.comparable()>h.comparable()&&(h=a.endDate),a};for(i=0,k=b.length;i<k;i++)a=b[i],e(a);d=function(a){var e,f,g,i,j,k;if(a.latestStartDate!=null&&a.latestEndDate!=null)return a;g=h,k=a.dependants;for(i=0,j=k.length;i<j;i++)f=k[i],e=d(b[c[f]]),e.latestStartDate.comparable()<g.comparable()&&(g=e.latestStartDate);return a.latestEndDate=g,a.latestStartDate=n.getActivitySchedule(a).getDateBeforeDuration(g,a.duration),a};for(j=0,l=b.length;j<l;j++)a=b[j],d(a);return b.sort(function(a,b){return a.startDate.comparable()>b.startDate.comparable()?1:b.startDate.comparable()>a.startDate.comparable()?-1:a.duration>b.duration?1:b.duration>a.duration?-1:0})},a.prototype.getActivityList=function(){var a,b,c,d,e;b=[],e=this.activities;for(c in e)a=e[c],d=_.clone(a),d.name=c,b.push(d);return b},a.prototype.getStarts=function(){var a,b,c,d,e,f,g=this;e=this.getDependantMap(),c={},b=function(a){var d,f,h,i,j,k,l,m,n,o;f=0,m=g.activities[a].predecessors;for(i=0,k=m.length;i<k;i++){h=m[i];if(c[h]==null)return!1;f=Math.max(f,c[h]+g.activities[h].duration)}c[a]=f,n=e[a],o=[];for(j=0,l=n.length;j<l;j++)d=n[j],o.push(b(d));return o},f=this.activities;for(a in f)d=f[a],d.predecessors.length===0&&b(a);return c},a.prototype.getDependantMap=function(){var a,b,c,d,e,f,g,h;b={},g=this.activities;for(c in g){a=g[c],b[c]==null&&(b[c]=[]);if(a.predecessors!=null){h=a.predecessors;for(e=0,f=h.length;e<f;e++)d=h[e],b[d].push(c)}}return b},a.prototype.getActivitySchedule=function(a){return a.scheduleName!=null?this.schedules[a.scheduleName]:this.schedules["default"]},a}()}.call(this),function(){this.GanttCanvas=function(){function a(a){a.gantt!=null&&(this.gantt=a.gantt),a.reference!=null&&(this.reference=a.reference)}return a.prototype.gantt=null,a.prototype.reference=null,a.prototype.dayWidth=20,a.prototype.rowHeight=30,a.prototype.weekHeaderHeight=25,a.prototype.dayHeaderHeight=25,a.prototype.majorGridWidth=1,a.prototype.minorGridWidth=1,a.prototype.minorGridColour="#CCCCCC",a.prototype.majorGridColour="#000000",a.prototype.availShade=255,a.prototype.unavailShade=150,a.prototype.nameWidth=200,a.prototype.activities=null,a.prototype.activityIndex={},a.prototype.context=null,a.prototype.headerFont="bold 8pt sans-serif",a.prototype.headerFontColour="#000000",a.prototype.activityNamePadding=5,a.prototype.activityFont="8pt sans-serif",a.prototype.activityFontColour="#000000",a.prototype.activityPadding=5,a.prototype.activityCompleteColour="#00FF00",a.prototype.activityIncompleteColour="#EEEEEE",a.prototype.activityCritical="#FF6666",a.prototype.activitySlack="#3399FF",a.prototype.activitySlackLine="#333333",a.prototype.activitySlackBar="rgba(51,153,255,0.4)",a.prototype.activitySlackBarHeight=6,a.prototype.activityLineWidth=2,a.prototype.arrowBuffer=8,a.prototype.arrowRegister={},a.prototype.arrowHeadSize=3,a.prototype.shadowOffsetX=3,a.prototype.shadowOffsetY=3,a.prototype.shadowColor="rgba(100,100,100,100)",a.prototype.shadowBlur=5,a.prototype.draw=function(){var a,b,c,d;if(this.gantt==null||this.reference==null||this.reference.getContext==null)return;this.arrowRegister={},this.context=this.reference.getContext("2d"),this.activities=this.gantt.getCompiledActivities(),d=this.activities;for(b=0,c=d.length;b<c;b++)a=d[b],this.activityIndex[a.name]=a;return this.context.canvas.width=this.getWidth(),this.context.canvas.height=this.getHeight(),this.drawGrid(),this.drawHeader(),this.drawActivities()},a.prototype.getHeight=function(){return this.activities.length===0?0:this.activities.length*this.rowHeight+this.getHeaderHeight()},a.prototype.getWidth=function(){return this.activities.length===0?0:this.nameWidth+this.dayWidth*this.getDays()},a.prototype.getStartDate=function(){return this.activities.length===0?null:_.first(this.activities).startDate.date},a.prototype.getEndDate=function(){return this.activities.length===0?null:_.last(this.activities).endDate.date},a.prototype.getDays=function(){return this.activities.length===0?0:(new XDate(this.getStartDate())).diffDays(new XDate(this.getEndDate()))+1},a.prototype.getStartDate=function(){return this.activities.length===0?null:_.first(this.activities).startDate.date},a.prototype.drawGrid=function(){var a,b,c,d,e,f,g;this.context.strokeStyle=this.minorGridColour,this.context.lineWidth=this.minorGridWidth,this.context.beginPath(),c=this.getHeaderHeight()+this.rowHeight;for(a=d=1,f=this.activities.length;1<=f?d<=f:d>=f;a=1<=f?++d:--d)this.context.moveTo(0,c+.5),this.context.lineTo(this.getWidth(),c+.5),c+=this.rowHeight;this.context.moveTo(this.nameWidth+.5,0),this.context.lineTo(this.nameWidth+.5,this.getHeaderHeight()),this.context.moveTo(this.nameWidth,this.weekHeaderHeight+.5),this.context.lineTo(this.getWidth(),this.weekHeaderHeight+.5),b=this.nameWidth+this.dayWidth;for(a=e=1,g=this.getDays();1<=g?e<=g:e>=g;a=1<=g?++e:--e)this.context.moveTo(b+.5,this.weekHeaderHeight),this.context.lineTo(b+.5,this.getHeight()),b+=this.dayWidth;return this.context.stroke(),this.context.strokeStyle=this.majorGridColour,this.context.lineWidth=this.majorGridWidth,this.context.beginPath(),this.context.moveTo(0,this.getHeaderHeight()+.5),this.context.lineTo(this.getWidth(),this.getHeaderHeight()+.5),this.context.moveTo(this.nameWidth+.5,this.getHeaderHeight()),this.context.lineTo(this.nameWidth+.5,this.getHeight()),this.context.stroke()},a.prototype.drawHeader=function(){var a,b,c,d,e,f;d=this.nameWidth,a=this.getStartDate(),b=this.getEndDate(),this.context.font=this.headerFont,this.context.fillStyle=this.headerFontColour,f=[];while(a<=b)e=new XDate(a),this.context.textAlign="center",this.context.textBaseline="middle",c=e.toString("ddd"),this.context.fillText(c.substring(0,1),d+this.dayWidth/2,this.weekHeaderHeight+this.dayHeaderHeight/2),c==="Mon"&&(this.context.textAlign="left",this.context.textBaseline="middle",this.context.fillText(a,d+this.dayWidth/2-4,this.weekHeaderHeight/2),this.context.strokeStyle=this.minorGridColour,this.context.lineWidth=this.minorGridWidth,this.context.beginPath(),this.context.moveTo(d+.5,0),this.context.lineTo(d+.5,this.weekHeaderHeight),this.context.stroke()),d+=this.dayWidth,f.push(a=GanttDate.dateToIso(e.addDays(1)));return f},a.prototype.drawActivities=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G;z=this.getHeaderHeight(),b={},E=this.activities;for(A=0,C=E.length;A<C;A++){a=E[A],this.context.font=this.activityFont,this.context.fillStyle=this.activityFontColour,this.context.textAlign="left",this.context.textBaseline="middle",this.context.fillText(a.name,this.activityNamePadding,z+this.rowHeight/2,this.nameWidth-this.activityNamePadding*2),x=this.nameWidth,f=this.getStartDate(),h=this.getEndDate();while(f<=h)o=this.gantt.getActivitySchedule(a),m=o.getAvailableHoursForDate(f),this.context.fillStyle=this.getAvailColour(m/8),this.context.fillRect(x+1,z+1,this.dayWidth-1,this.rowHeight-1),y=new XDate(f),a.startDate.date===f&&(w=x),a.endDate.date===f&&(l=x),a.latestEndDate.date===f&&(s=x),x+=this.dayWidth,f=GanttDate.dateToIso(y.addDays(1));t=this.gantt.getActivitySchedule(a).getAvailableHoursForDate(a.startDate.date),v=a.startDate.hour/t,u=this.getDayInnerWidth()*v,i=this.gantt.getActivitySchedule(a).getAvailableHoursForDate(a.endDate.date),k=a.endDate.hour/i,j=this.getDayInnerWidth()*k,p=this.gantt.getActivitySchedule(a).getAvailableHoursForDate(a.latestEndDate.date),r=a.latestEndDate.hour/p,q=this.getDayInnerWidth()*r,this.context.fillStyle=this.activityIncompleteColour,a.x=Math.round(w+this.activityPadding+u),a.y=z+this.activityPadding,a.width=Math.round(l-w-u+j),a.height=this.rowHeight-this.activityPadding*2,a.slack={x:a.x+a.width,y:a.y+Math.round(a.height/3-this.activitySlackBarHeight/2),width:s-l-j+q,height:this.activitySlackBarHeight},this.drawActivity(a),z+=this.rowHeight;if(a.predecessors.length>0){n=Math.round((a.x+this.arrowBuffer)/this.arrowBuffer)*this.arrowBuffer;while(this.arrowExists(n))n+=this.arrowBuffer;this.registerArrow(n),b[a.name]=n}}F=this.activities,G=[];for(B=0,D=F.length;B<D;B++)a=F[B],d=a.x+a.width,e=Math.round(a.y+a.height/3*2),G.push(function(){var h,i,j,k;j=a.dependants,k=[];for(h=0,i=j.length;h<i;h++)g=j[h],f=this.activityIndex[g],c=f.y-this.activityLineWidth,this.context.strokeStyle=this.activitySlackLine,this.context.lineWidth=this.activityLineWidth,this.context.beginPath(),this.context.moveTo(d,e),this.context.lineTo(b[g]-this.arrowBuffer,e),this.context.bezierCurveTo(b[g]-this.arrowBuffer/3*2,e,b[g],e+this.arrowBuffer/3*2,b[g],e+this.arrowBuffer),this.context.lineTo(b[g],c),this.context.lineTo(b[g]-this.arrowHeadSize,c-this.arrowHeadSize),this.context.moveTo(b[g],c),this.context.lineTo(b[g]+this.arrowHeadSize,c-this.arrowHeadSize),k.push(this.context.stroke());return k}.call(this));return G},a.prototype.drawActivity=function(a){this.enableShadow(),this.context.fillRect(a.x,a.y,a.width,a.height),this.disableShadow(),this.context.strokeStyle=a.endDate.comparable()<a.latestEndDate.comparable()?this.activitySlack:this.activityCritical,this.context.lineWidth=this.activityLineWidth,this.context.strokeRect(a.x,a.y,a.width,a.height);if(a.endDate.comparable()<a.latestEndDate.comparable())return this.context.fillStyle=this.activitySlackBar,this.context.fillRect(a.slack.x,a.slack.y,a.slack.width,a.slack.height)},a.prototype.getHeaderHeight=function(){return this.weekHeaderHeight+this.dayHeaderHeight},a.prototype.getAvailColour=function(a){var b,c,d;return a=Math.max(0,Math.min(a,1)),b=Math.abs(this.availShade-this.unavailShade),c=b*a,d=Math.round(Math.min(this.unavailShade,this.availShade)+c),"rgb("+d+","+d+","+d+")"},a.prototype.getDayInnerWidth=function(){return this.dayWidth-this.activityPadding*2},a.prototype.enableShadow=function(){return this.context.shadowOffsetX=this.shadowOffsetX,this.context.shadowOffsetY=this.shadowOffsetY,this.context.shadowColor=this.shadowColor,this.context.shadowBlur=this.shadowBlur},a.prototype.disableShadow=function(){return this.context.shadowColor="rgba(0,0,0,0)"},a.prototype.registerArrow=function(a){return this.arrowRegister[Math.round(a/this.arrowBuffer)]=!0},a.prototype.arrowExists=function(a){return this.arrowRegister[Math.round(a/this.arrowBuffer)]!=null},a}()}.call(this),function(){this.GanttSchedule=function(){function a(){}return a.prototype.defaultWorkTimes={Monday:8,Tuesday:8,Wednesday:8,Thursday:8,Friday:8,Saturday:0,Sunday:0},a.prototype.overriddenWorkTimes={},a.prototype.getDateAfterDuration=function(a,b){var c,d,e;a.hour!=null&&(b+=a.hour),c=new XDate(a.date);for(;;){d=this.getAvailableHoursForDate(c),b-=d;if(b<=0)break;c=c.addDays(1)}return e=d+b,new GanttDate({date:c,hour:e,availableHours:d})},a.prototype.getDateBeforeDuration=function(a,b){var c,d,e;a.hour!=null&&(b-=a.hour),c=new XDate(a.date);while(!(b<=0))c.addDays(-1),d=this.getAvailableHoursForDate(c),b-=d;return e=-b,new GanttDate({date:c,hour:e,availableHours:d})},a.prototype.getAvailableHoursForDate=function(a){return a.getMilliseconds!=null&&(a=GanttDate.dateToIso(a)),this.overriddenWorkTimes[a]||this.defaultWorkTimes[GanttDate.isoToDate(a).toString("dddd")]},a.prototype.getHoursBetweenDates=function(a,b,c,d){var e,f;f=d-b,e=_.clone(a);while(e!==c)f+=this.getAvailableHoursForDate(e),e=e.addDays(1);return f},a}()}.call(this),function(){var a,b;a=function(a){return a.toString("yyyy-MM-dd")},b=function(a){return new XDate(a)},this.GanttDate=function(){function b(a){this.set(a)}return b.prototype.date=null,b.prototype.hour=null,b.prototype.availableHours=null,b.prototype.ratio=function(){return this.hour==null||this.availableHours==null?null:this.hour/this.availableHours},b.prototype.comparable=function(){return""+this.date+" "+(this.hour<10?"0":"")+this.hour},b.prototype.set=function(a){a.date!=null&&this.setDate(a.date),a.hour!=null&&(this.hour=a.hour);if(a.availableHours!=null)return this.availableHours=a.availableHours},b.prototype.setDate=function(b){return this.date=_.isObject(b)?a(b):b},b}(),GanttDate.dateToIso=a,GanttDate.isoToDate=b}.call(this)